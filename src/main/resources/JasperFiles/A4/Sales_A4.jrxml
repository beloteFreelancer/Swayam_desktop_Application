<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd"
    name="Sales_A4" language="groovy" pageWidth="595" pageHeight="842" columnWidth="555"
    leftMargin="15" rightMargin="15" topMargin="2" bottomMargin="20"
    whenNoDataType="NoPages" isSummaryNewPage="false">

    <!-- Parameters for Customer Details -->
    <parameter name="CustomerName" class="java.lang.String"/>
    <parameter name="CustomerPhone" class="java.lang.String"/>
    <parameter name="CustomerAddress" class="java.lang.String"/>
    <parameter name="CustomerGSTIN" class="java.lang.String"/>
    <parameter name="InvoiceNo" class="java.lang.String"/>
    <parameter name="InvoiceDate" class="java.lang.String"/>
    <parameter name="SalesMan" class="java.lang.String"/>
    <parameter name="AmountInWords" class="java.lang.String"/>
    <parameter name="TotalAmountBeforeTax" class="java.lang.Double"/>
    <parameter name="CGSTAmount" class="java.lang.Double"/>
    <parameter name="SGSTAmount" class="java.lang.Double"/>
    <parameter name="IGSTAmount" class="java.lang.Double"/>
    <parameter name="TaxAmountGST" class="java.lang.Double"/>
    <parameter name="GrandTotal" class="java.lang.Double"/>
    <!-- Formatted String Parameters -->
    <parameter name="TotalAmountBeforeTaxStr" class="java.lang.String"/>
    <parameter name="CGSTAmountStr" class="java.lang.String"/>
    <parameter name="SGSTAmountStr" class="java.lang.String"/>
    <parameter name="IGSTAmountStr" class="java.lang.String"/>
    <parameter name="TaxAmountGSTStr" class="java.lang.String"/>
    <parameter name="GrandTotalStr" class="java.lang.String"/>
    <!-- Parameters for Company Details -->
    <parameter name="CompanyName" class="java.lang.String"/>
    <parameter name="CompanyAddress" class="java.lang.String"/>
    <parameter name="CompanyGST" class="java.lang.String"/>

    <!-- Fields for Sale Product Details Table -->
    <field name="sno" class="java.lang.String"/>
    <field name="product_name" class="java.lang.String"/>
    <field name="mrp" class="java.lang.String"/>
    <field name="rate" class="java.lang.String"/>
    <field name="qty" class="java.lang.String"/>
    <field name="amount" class="java.lang.String"/>

    <!-- Variables for totals -->
    <variable name="TotalQty" class="java.lang.Double" calculation="Sum" resetType="Report">
        <variableExpression><![CDATA[$F{qty} == null || $F{qty}.trim().isEmpty() ? 0.0 : Double.valueOf($F{qty}.trim().replace(",", ""))]]></variableExpression>
        <initialValueExpression><![CDATA[0.0]]></initialValueExpression>
    </variable>
    <variable name="TotalAmount" class="java.lang.Double" calculation="Sum" resetType="Report">
        <variableExpression><![CDATA[$F{amount} == null || $F{amount}.trim().isEmpty() ? 0.0 : Double.valueOf($F{amount}.trim().replace(",", ""))]]></variableExpression>
        <initialValueExpression><![CDATA[0.0]]></initialValueExpression>
    </variable>

    <title>
        <band height="130">
            <!-- Logo Placeholder (moved down) -->
            <image>
                <reportElement x="0" y="20" width="70" height="70"/>
                <imageExpression><![CDATA["logo.png"]]></imageExpression>
            </image>
            <!-- Orange Title Bar (moved down) -->
            <rectangle>
                <reportElement x="80" y="20" width="435" height="30" backcolor="#FFA500" mode="Opaque"/>
            </rectangle>
            <staticText>
                <reportElement x="80" y="20" width="435" height="30"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font size="16" isBold="true"/>
                </textElement>
                <text><![CDATA[TAX INVOICE]]></text>
            </staticText>
            <!-- Company Name (Dynamic, moved down) -->
            <textField>
                <reportElement x="80" y="52" width="435" height="18"/>
                <textElement textAlignment="Center">
                    <font size="12" isBold="true"/>
                </textElement>
                <textFieldExpression><![CDATA[$P{CompanyName}]]></textFieldExpression>
            </textField>
            <!-- Address (Dynamic, moved down) -->
            <textField>
                <reportElement x="80" y="70" width="435" height="15"/>
                <textElement textAlignment="Center">
                    <font size="10"/>
                </textElement>
                <textFieldExpression><![CDATA[$P{CompanyAddress}]]></textFieldExpression>
            </textField>
            <!-- GSTIN (Dynamic, moved down) -->
            <textField>
                <reportElement x="80" y="85" width="435" height="15"/>
                <textElement textAlignment="Center">
                    <font size="10"/>
                </textElement>
                <textFieldExpression><![CDATA["GSTIN : " + $P{CompanyGST}]]></textFieldExpression>
            </textField>
            <!-- Decorative Circles (moved down) -->
            <ellipse>
                <reportElement x="530" y="30" width="30" height="30" forecolor="#FFA500"/>
            </ellipse>
            <ellipse>
                <reportElement x="550" y="50" width="20" height="20" forecolor="#FFA500"/>
            </ellipse>
        </band>
    </title>

    <pageHeader>
        <band height="70">
            <!-- CUSTOMER DETAILS Label -->
            <staticText>
                <reportElement x="0" y="0" width="160" height="18"/>
                <textElement>
                    <font size="11" isBold="true"/>
                </textElement>
                <text><![CDATA[CUSTOMER DETAILS]]></text>
            </staticText>
            <!-- Orange underline -->
            <rectangle>
                <reportElement x="0" y="18" width="555" height="2" backcolor="#FFA500" mode="Opaque"/>
            </rectangle>
            <!-- Left Column -->
            <staticText>
                <reportElement x="0" y="22" width="50" height="12"/>
                <textElement><font size="9" isBold="true"/></textElement>
                <text><![CDATA[Name:]]></text>
            </staticText>
            <textField>
                <reportElement x="52" y="22" width="120" height="12"/>
                <textElement><font size="9"/></textElement>
                <textFieldExpression><![CDATA[$P{CustomerName}]]></textFieldExpression>
            </textField>
            <staticText>
                <reportElement x="0" y="34" width="50" height="12"/>
                <textElement><font size="9" isBold="true"/></textElement>
                <text><![CDATA[Phone Number:]]></text>
            </staticText>
            <textField>
                <reportElement x="52" y="34" width="120" height="12"/>
                <textElement><font size="9"/></textElement>
                <textFieldExpression><![CDATA[$P{CustomerPhone}]]></textFieldExpression>
            </textField>
            <staticText>
                <reportElement x="0" y="46" width="50" height="12"/>
                <textElement><font size="9" isBold="true"/></textElement>
                <text><![CDATA[Address:]]></text>
            </staticText>
            <textField>
                <reportElement x="52" y="46" width="120" height="12"/>
                <textElement><font size="9"/></textElement>
                <textFieldExpression><![CDATA[$P{CustomerAddress}]]></textFieldExpression>
            </textField>
            <staticText>
                <reportElement x="0" y="58" width="50" height="12"/>
                <textElement><font size="9" isBold="true"/></textElement>
                <text><![CDATA[GSTIN:]]></text>
            </staticText>
            <textField>
                <reportElement x="52" y="58" width="120" height="12"/>
                <textElement><font size="9"/></textElement>
                <textFieldExpression><![CDATA[$P{CustomerGSTIN}]]></textFieldExpression>
            </textField>
            <!-- Right Column -->
            <staticText>
                <reportElement x="350" y="22" width="60" height="12"/>
                <textElement><font size="9" isBold="true"/></textElement>
                <text><![CDATA[Invoice No:]]></text>
            </staticText>
            <textField>
                <reportElement x="412" y="22" width="120" height="12"/>
                <textElement><font size="9"/></textElement>
                <textFieldExpression><![CDATA[$P{InvoiceNo}]]></textFieldExpression>
            </textField>
            <staticText>
                <reportElement x="350" y="34" width="60" height="12"/>
                <textElement><font size="9" isBold="true"/></textElement>
                <text><![CDATA[Date:]]></text>
            </staticText>
            <textField>
                <reportElement x="412" y="34" width="120" height="12"/>
                <textElement><font size="9"/></textElement>
                <textFieldExpression><![CDATA[$P{InvoiceDate}]]></textFieldExpression>
            </textField>
            <staticText>
                <reportElement x="350" y="46" width="60" height="12"/>
                <textElement><font size="9" isBold="true"/></textElement>
                <text><![CDATA[Sales Man:]]></text>
            </staticText>
            <textField>
                <reportElement x="412" y="46" width="120" height="12"/>
                <textElement><font size="9"/></textElement>
                <textFieldExpression><![CDATA[$P{SalesMan}]]></textFieldExpression>
            </textField>
        </band>
    </pageHeader>

    <columnHeader>
        <band height="26">
            <!-- Header background -->
            <rectangle>
                <reportElement x="0" y="2" width="555" height="22" backcolor="#FFE5B4" mode="Opaque"/>
            </rectangle>
            <!-- Vertical lines for columns -->
            <line><reportElement x="0" y="2" width="0" height="22"/></line> <!-- First column left side -->
            <line><reportElement x="30" y="2" width="0" height="22"/></line>
            <line><reportElement x="230" y="2" width="0" height="22"/></line>
            <line><reportElement x="295" y="2" width="0" height="22"/></line>
            <line><reportElement x="360" y="2" width="0" height="22"/></line>
            <line><reportElement x="425" y="2" width="0" height="22"/></line>
            <line><reportElement x="555" y="2" width="0" height="22"/></line> <!-- Last column right side -->
            <!-- S. No. Header Cell -->
            <staticText>
                <reportElement x="0" y="2" width="30" height="22"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font isBold="true" size="10"/>
                </textElement>
                <text><![CDATA[S. No.]]></text>
            </staticText>
            <!-- Product Name Header Cell -->
            <staticText>
                <reportElement x="30" y="2" width="200" height="22"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font isBold="true" size="10"/>
                </textElement>
                <text><![CDATA[Name of product / Service]]></text>
            </staticText>
            <!-- MRP Header Cell -->
            <staticText>
                <reportElement x="230" y="2" width="65" height="22"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font isBold="true" size="10"/>
                </textElement>
                <text><![CDATA[MRP]]></text>
            </staticText>
            <!-- Rate Header Cell -->
            <staticText>
                <reportElement x="295" y="2" width="65" height="22"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font isBold="true" size="10"/>
                </textElement>
                <text><![CDATA[Rate]]></text>
            </staticText>
            <!-- Qty Header Cell -->
            <staticText>
                <reportElement x="360" y="2" width="65" height="22"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font isBold="true" size="10"/>
                </textElement>
                <text><![CDATA[Qty]]></text>
            </staticText>
            <!-- Amount Header Cell -->
            <staticText>
                <reportElement x="425" y="2" width="130" height="22"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font isBold="true" size="10"/>
                </textElement>
                <text><![CDATA[Amount]]></text>
            </staticText>
            <line>
                <reportElement x="0" y="0" width="555" height="1"/>
            </line>
            <line>
                <reportElement x="0" y="24" width="555" height="1"/>
            </line>
        </band>
    </columnHeader>

    <detail>
        <band height="20">
            <!-- Vertical lines for columns -->
            <line><reportElement x="0" y="0" width="0" height="20"/></line> <!-- First column left side -->
            <line><reportElement x="30" y="0" width="0" height="20"/></line>
            <line><reportElement x="230" y="0" width="0" height="20"/></line>
            <line><reportElement x="295" y="0" width="0" height="20"/></line>
            <line><reportElement x="360" y="0" width="0" height="20"/></line>
            <line><reportElement x="425" y="0" width="0" height="20"/></line>
            <line><reportElement x="555" y="0" width="0" height="20"/></line> <!-- Last column right side -->
            <textField>
                <reportElement x="0" y="0" width="30" height="20"/>
                <textElement textAlignment="Center" verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[$F{sno}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="30" y="0" width="200" height="20"/>
                <textElement textAlignment="Center" verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[$F{product_name}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="230" y="0" width="65" height="20"/>
                <textElement textAlignment="Center" verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[$F{mrp}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="295" y="0" width="65" height="20"/>
                <textElement textAlignment="Center" verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[$F{rate}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="360" y="0" width="65" height="20"/>
                <textElement textAlignment="Center" verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[$F{qty}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="425" y="0" width="130" height="20"/>
                <textElement textAlignment="Center" verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[$F{amount}]]></textFieldExpression>
            </textField>
        </band>
    </detail>

    <summary>
        <band height="240">
            <!-- Main Border for Summary Section -->
            <rectangle>
                <reportElement x="0" y="0" width="555" height="100" forecolor="#000000" backcolor="#FFFFFF" mode="Opaque"/>
            </rectangle>
            <!-- Total Row -->
            <line>
                <reportElement x="0" y="0" width="555" height="1"/>
            </line>
            <staticText>
                <reportElement x="0" y="1" width="360" height="20"/>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font isBold="true" size="10"/>
                </textElement>
                <text><![CDATA[Total]]></text>
            </staticText>
            <textField pattern="#,##0">
                <reportElement x="360" y="1" width="65" height="20"/>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font isBold="true" size="10"/>
                </textElement>
                <textFieldExpression><![CDATA[$V{TotalQty}]]></textFieldExpression>
            </textField>
            <textField pattern="#,##0.00">
                <reportElement x="425" y="1" width="130" height="20"/>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font isBold="true" size="10"/>
                </textElement>
                <textFieldExpression><![CDATA[$V{TotalAmount}]]></textFieldExpression>
            </textField>

            <!-- Summary Table -->
            <rectangle>
                <reportElement x="0" y="22" width="555" height="80" forecolor="#000000" backcolor="#FFFFFF" mode="Opaque"/>
            </rectangle>
            <!-- Summary values (right side) -->
            <staticText>
                <reportElement x="325" y="24" width="120" height="12"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <text><![CDATA[Total Amount Before Tax]]></text>
            </staticText>
            <textField evaluationTime="Report" isBlankWhenNull="true">
                <reportElement x="445" y="24" width="105" height="12"/>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[$P{TotalAmountBeforeTaxStr} == null ? "0.00" : $P{TotalAmountBeforeTaxStr}]]></textFieldExpression>
            </textField>
            <staticText>
                <reportElement x="325" y="36" width="120" height="12"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <text><![CDATA[CGST Amount]]></text>
            </staticText>
            <textField evaluationTime="Report" isBlankWhenNull="true">
                <reportElement x="445" y="36" width="105" height="12"/>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[$P{CGSTAmountStr} == null ? "0.00" : $P{CGSTAmountStr}]]></textFieldExpression>
            </textField>
            <staticText>
                <reportElement x="325" y="48" width="120" height="12"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <text><![CDATA[SGST Amount]]></text>
            </staticText>
            <textField evaluationTime="Report" isBlankWhenNull="true">
                <reportElement x="445" y="48" width="105" height="12"/>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[$P{SGSTAmountStr} == null ? "0.00" : $P{SGSTAmountStr}]]></textFieldExpression>
            </textField>
            <staticText>
                <reportElement x="325" y="60" width="120" height="12"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <text><![CDATA[IGST Amount]]></text>
            </staticText>
            <textField evaluationTime="Report" isBlankWhenNull="true">
                <reportElement x="445" y="60" width="105" height="12"/>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[$P{IGSTAmountStr} == null ? "0.00" : $P{IGSTAmountStr}]]></textFieldExpression>
            </textField>
            <staticText>
                <reportElement x="325" y="72" width="120" height="12"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <text><![CDATA[Tax Amount + GST]]></text>
            </staticText>
            <textField evaluationTime="Report" isBlankWhenNull="true">
                <reportElement x="445" y="72" width="105" height="12"/>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[$P{TaxAmountGSTStr} == null ? "0.00" : $P{TaxAmountGSTStr}]]></textFieldExpression>
            </textField>
            <staticText>
                <reportElement x="325" y="84" width="120" height="12"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <text><![CDATA[Grand Total]]></text>
            </staticText>
            <textField evaluationTime="Report" isBlankWhenNull="true">
                <reportElement x="445" y="84" width="105" height="12"/>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[$P{GrandTotalStr} == null ? "0.00" : $P{GrandTotalStr}]]></textFieldExpression>
            </textField>

            <!-- Amount in words (moved before Declaration, made bold) -->
            <staticText>
                <reportElement x="2" y="110" width="120" height="12"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font isBold="true" size="9"/>
                </textElement>
                <text><![CDATA[Amount in words :]]></text>
            </staticText>
            <textField evaluationTime="Report" textAdjust="StretchHeight" isBlankWhenNull="true">
                <reportElement x="122" y="110" width="430" height="30" isPrintWhenDetailOverflows="true"/>
                <textElement textAlignment="Left" verticalAlignment="Top">
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[$P{AmountInWords}]]></textFieldExpression>
            </textField>
            <!-- Declaration -->
            <staticText>
                <reportElement x="0" y="140" width="555" height="15"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <text><![CDATA[Declaration : We declare that this invoice shows the actual price of the goods described and that all particulars are true and correct.]]></text>
            </staticText>
            <!-- Terms and Conditions (made bold) -->
            <staticText>
                <reportElement x="0" y="160" width="555" height="30"/>
                <textElement textAlignment="Left" verticalAlignment="Top">
                    <font size="8" isBold="true"/>
                </textElement>
                <text><![CDATA[Terms and Conditions:
1. Goods once sold will not be taken back or exchanged.
2. Interest @24% p.a. will be charged on overdue accounts.
3. Subject to jurisdiction.]]></text>
            </staticText>
            <!-- Signature -->
            
               <textField>
                <reportElement x="500" y="200"  width="120" height="12"/>
                <textElement><font size="9"/></textElement>
                <textFieldExpression><![CDATA[$P{CompanyName}]]></textFieldExpression>
             </textField>
            <staticText>
                <reportElement x="400" y="215" width="155" height="15"/>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <text><![CDATA[Authorized Signatory]]></text>
            </staticText>
        </band>
    </summary>
</jasperReport>